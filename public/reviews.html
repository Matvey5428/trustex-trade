<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TrustEx - Reviews</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="js/i18n.js" defer></script>
  <script src="js/auth.js?v=2" defer></script>
  <script src="js/api.js" defer></script>
  <style>body { opacity: 0; } body.i18n-ready { opacity: 1; transition: opacity 0.15s ease-out; }</style>
  <script>(function() { var lang = localStorage.getItem('nexo_lang') || 'ru'; document.documentElement.lang = lang; setTimeout(function() { document.body && document.body.classList.add('i18n-ready'); }, 500); document.addEventListener('gesturestart', function(e) { e.preventDefault(); }); document.addEventListener('gesturechange', function(e) { e.preventDefault(); }); document.addEventListener('gestureend', function(e) { e.preventDefault(); }); document.addEventListener('touchstart', function(e) { if(e.touches.length > 1) e.preventDefault(); }, { passive: false }); })();</script>
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-card: #1c2128;
      --bg-hover: #262c36;
      --accent: #00d4aa;
      --accent-dim: rgba(0, 212, 170, 0.1);
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --border-color: #30363d;
      --success: #3fb950;
      --danger: #f85149;
      --warning: #d29922;
      --star-color: #ffc107;
    }
    
    * { box-sizing: border-box; }
    html, body {
      touch-action: pan-x pan-y;
      -ms-touch-action: pan-x pan-y;
    }
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      padding-bottom: 100px;
    }
    
    .app-container {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }
    
    /* Header */
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      margin-bottom: 20px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 18px;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
    }
    
    .lang-selector {
      display: flex;
      background: var(--bg-card);
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }
    
    .lang-btn {
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .lang-btn.active {
      background: var(--accent);
      color: #000;
    }
    
    /* Stats Card */
    .stats-card {
      background: linear-gradient(135deg, var(--accent) 0%, #00a884 100%);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      color: #000;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stats-main {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    
    .stats-number {
      font-size: 42px;
      font-weight: 700;
      line-height: 1;
    }
    
    .stats-label {
      font-size: 14px;
      font-weight: 500;
      opacity: 0.8;
    }
    
    .stats-rating {
      text-align: right;
    }
    
    .rating-value {
      font-size: 28px;
      font-weight: 700;
    }
    
    .rating-stars {
      font-size: 14px;
      margin-top: 4px;
    }
    
    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    
    .filter-tab {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 10px 18px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .filter-tab:hover {
      background: var(--bg-hover);
    }
    
    .filter-tab.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }
    
    /* Review Card */
    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .review-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid var(--border-color);
      transition: all 0.2s;
    }
    
    .review-card:hover {
      background: var(--bg-hover);
    }
    
    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .review-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      color: #fff;
    }
    
    .user-info {}
    
    .user-name {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 2px;
    }
    
    .user-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--accent-dim);
      color: var(--accent);
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
    }
    
    .review-date {
      color: var(--text-muted);
      font-size: 12px;
    }
    
    .review-text {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .review-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .review-stars {
      color: var(--star-color);
      font-size: 14px;
      letter-spacing: 2px;
    }
    
    .review-helpful {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text-muted);
      font-size: 12px;
    }
    
    .helpful-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: all 0.2s;
    }
    
    .helpful-btn:hover {
      background: var(--bg-hover);
      color: var(--accent);
    }
    
    /* Loading & Empty states */
    .loading-state,
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Back to Top */
    .back-to-top {
      position: fixed;
      right: 20px;
      bottom: 100px;
      width: 48px;
      height: 48px;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0, 212, 170, 0.3);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 1000;
    }
    
    .back-to-top.show {
      opacity: 1;
      visibility: visible;
    }
    
    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 9998;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 11px;
      padding: 4px 16px;
      transition: all 0.2s;
    }
    
    .nav-item.active {
      color: var(--accent);
    }
    
    .nav-icon {
      font-size: 20px;
    }
    
    /* Bottom Navigation Bar */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 9999;
      background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
      border-top: 1px solid rgba(48, 54, 61, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 12px 0 max(16px, env(safe-area-inset-bottom));
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: #6e7681;
      padding: 8px 0;
      border-radius: 12px;
      transition: color 0.15s ease;
      flex: 1;
      position: relative;
      -webkit-tap-highlight-color: transparent;
    }

    .nav-item:hover { color: #8b949e; }
    .nav-item.active { color: var(--accent); }

    .nav-item::before {
      content: '';
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 2px;
      background: var(--accent);
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.15s ease;
    }

    .nav-item.active::before {
      opacity: 1;
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-icon svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .nav-label { font-size: 10px; font-weight: 500; }
  </style>
</head>
<body>

<div class="app-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <a href="index.html" class="back-btn">‚Üê</a>
      <h1 class="page-title" data-i18n="reviews">Reviews</h1>
    </div>
    <div class="lang-selector">
      <button class="lang-btn active" onclick="switchLang('en')">EN</button>
      <button class="lang-btn" onclick="switchLang('ru')">RU</button>
    </div>
  </div>

  <!-- Stats Card -->
  <div class="stats-card">
    <div class="stats-row">
      <div>
        <div class="stats-main">
          <span class="stats-number" id="totalReviews">0</span>
          <span class="stats-label" data-i18n="reviewsCount">reviews</span>
        </div>
      </div>
      <div class="stats-rating">
        <div class="rating-value">4.9</div>
        <div class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    </div>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <button class="filter-tab active" data-filter="all" data-i18n="all">All</button>
    <button class="filter-tab" data-filter="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</button>
    <button class="filter-tab" data-filter="4">‚òÖ‚òÖ‚òÖ‚òÖ</button>
    <button class="filter-tab" data-filter="3">‚òÖ‚òÖ‚òÖ</button>
  </div>

  <!-- Reviews List -->
  <div class="reviews-list" id="reviewsContainer">
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <div data-i18n="loading">Loading...</div>
    </div>
  </div>
</div>

<!-- Back to Top -->
<button class="back-to-top" id="backToTop">‚Üë</button>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <a href="index.html" class="nav-item">
    <span class="nav-icon">üíº</span>
    <span data-i18n="assets">Assets</span>
  </a>
  <a href="trading.html" class="nav-item">
    <span class="nav-icon">üìä</span>
    <span data-i18n="trading">Trading</span>
  </a>
  <a href="exchange.html" class="nav-item">
    <span class="nav-icon">üîÑ</span>
    <span data-i18n="exchange">Exchange</span>
  </a>
</div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg?.expand) tg.expand();

  const container = document.getElementById('reviewsContainer');
  const totalEl = document.getElementById('totalReviews');
  let allReviews = [];
  let currentFilter = 'all';
  
  // Language switcher
  function switchLang(lang) {
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    if (typeof applyLanguage === 'function') {
      applyLanguage(lang);
    }
    renderReviews(filterReviews());
  }

  // Initialize language
  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('nexo_lang') || 'en';
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.textContent.toLowerCase() === savedLang);
    });
  });

  // Sample reviews generator
  function generateReviews() {
    const lang = localStorage.getItem('nexo_lang') || 'en';
    
    const namesEN = ['Alex M.', 'Sarah K.', 'Michael R.', 'Emily J.', 'David L.', 'Jessica W.', 'Chris B.', 'Amanda P.', 'Ryan T.', 'Nicole S.', 'Brandon H.', 'Megan C.', 'Tyler D.', 'Ashley F.', 'Kevin G.', 'Stephanie N.'];
    const namesRU = ['–ê–ª–µ–∫—Å–µ–π –ú.', '–ú–∞—Ä–∏—è –ö.', '–ú–∏—Ö–∞–∏–ª –†.', '–ï–ª–µ–Ω–∞ –ñ.', '–î–º–∏—Ç—Ä–∏–π –õ.', '–ê–Ω–Ω–∞ –í.', '–ö–∏—Ä–∏–ª–ª –ë.', '–û–ª—å–≥–∞ –ü.', '–†–æ–º–∞–Ω –¢.', '–ù–∞—Ç–∞–ª—å—è –°.', '–ë–æ—Ä–∏—Å –•.', '–ú–∞—Ä–∏–Ω–∞ –¶.', '–¢–∏–º—É—Ä –î.', '–ê–ª–∏–Ω–∞ –§.', '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –ì.', '–°–≤–µ—Ç–ª–∞–Ω–∞ –ù.'];
    
    const reviewsEN = [
      'Excellent platform! Fast transactions and intuitive interface. Highly recommended.',
      'Been using TrustEx for 3 months now. Great experience overall, support is responsive.',
      'The best trading platform I\'ve used. Low fees and reliable execution.',
      'Easy to use, even for beginners. The mobile interface is clean and modern.',
      'Withdrawals are processed quickly. Very satisfied with the service.',
      'Professional platform with great security features. Feel safe trading here.',
      'Love the new design! Much better than before. Keep up the good work!',
      'Competitive rates and fast exchange. Will continue using TrustEx.',
      'Customer support helped me resolve an issue within hours. Impressive!',
      'Simple registration process and smooth verification. Started trading in minutes.',
      'The charting tools are excellent. Perfect for technical analysis.',
      'Fast deposits and withdrawals. No issues so far.',
      'Great liquidity and tight spreads. Professional trading experience.',
      'Mobile app works flawlessly. Trade on the go without any problems.',
      'Transparent fees and no hidden charges. Honest platform.',
      'The binary options feature is amazing. Easy to predict and earn.'
    ];
    
    const reviewsRU = [
      '–û—Ç–ª–∏—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞! –ë—ã—Å—Ç—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –†–µ–∫–æ–º–µ–Ω–¥—É—é.',
      '–ò—Å–ø–æ–ª—å–∑—É—é TrustEx —É–∂–µ 3 –º–µ—Å—è—Ü–∞. –û—Ç–ª–∏—á–Ω—ã–π –æ–ø—ã—Ç, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ.',
      '–õ—É—á—à–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞. –ù–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.',
      '–õ–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–∂–µ –Ω–æ–≤–∏—á–∫–∞–º. –ú–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∏—Å—Ç—ã–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π.',
      '–í—ã–≤–æ–¥—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ. –û—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω —Å–µ—Ä–≤–∏—Å–æ–º.',
      '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –æ—Ç–ª–∏—á–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é. –¢–æ—Ä–≥—É—é –∑–¥–µ—Å—å —Å–ø–æ–∫–æ–π–Ω–æ.',
      '–ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω –æ–≥–æ–Ω—å! –ù–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ, —á–µ–º –±—ã–ª–æ. –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!',
      '–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –∏ –±—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω. –ë—É–¥—É –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TrustEx.',
      '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–º–æ–≥–ª–∞ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∑–∞ –ø–∞—Ä—É —á–∞—Å–æ–≤. –í–ø–µ—á–∞—Ç–ª—è–µ—Ç!',
      '–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –±—ã—Å—Ç—Ä–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è. –ù–∞—á–∞–ª —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –∑–∞ –º–∏–Ω—É—Ç—ã.',
      '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤ –æ—Ç–ª–∏—á–Ω—ã–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.',
      '–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∏ –≤—ã–≤–æ–¥—ã. –ü—Ä–æ–±–ª–µ–º –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ.',
      '–•–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∏ —É–∑–∫–∏–µ —Å–ø—Ä–µ–¥—ã. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π–¥–∏–Ω–≥.',
      '–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ. –¢–æ—Ä–≥—É—é –Ω–∞ —Ö–æ–¥—É –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.',
      '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –±–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π. –ß–µ—Å—Ç–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞.',
      '–ë–∏–Ω–∞—Ä–Ω—ã–µ –æ–ø—Ü–∏–æ–Ω—ã - —Å—É–ø–µ—Ä —Ñ—É–Ω–∫—Ü–∏—è. –õ–µ–≥–∫–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.'
    ];
    
    const names = lang === 'ru' ? namesRU : namesEN;
    const reviews = lang === 'ru' ? reviewsRU : reviewsEN;
    const badges = lang === 'ru' ? ['–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω', '–¢—Ä–µ–π–¥–µ—Ä', '–ê–∫—Ç–∏–≤–Ω—ã–π', 'Pro'] : ['Verified', 'Trader', 'Active', 'Pro'];
    
    const result = [];
    const daysAgo = [1, 2, 3, 5, 7, 10, 14, 21, 30];
    
    for (let i = 0; i < 36; i++) {
      const nameIdx = i % names.length;
      const reviewIdx = i % reviews.length;
      const rating = i < 28 ? 5 : (i < 33 ? 4 : 3);
      const dayOffset = daysAgo[i % daysAgo.length];
      const date = new Date();
      date.setDate(date.getDate() - dayOffset);
      
      result.push({
        id: 1001 + i,
        name: names[nameIdx],
        initials: names[nameIdx].split(' ').map(n => n[0]).join(''),
        badge: badges[i % badges.length],
        text: reviews[reviewIdx],
        rating: rating,
        date: date.toLocaleDateString(lang === 'ru' ? 'ru-RU' : 'en-US'),
        helpful: Math.floor(Math.random() * 20) + 1
      });
    }
    
    return result;
  }

  async function loadReviews() {
    try {
      const response = await fetch('/api/reviews');
      
      if (response.ok) {
        const payload = await response.json();
        allReviews = Array.isArray(payload) ? payload : (Array.isArray(payload?.data) ? payload.data : []);
      }

      if (!allReviews.length) {
        allReviews = generateReviews();
      }
      
      totalEl.textContent = allReviews.length;
      renderReviews(allReviews);
      
    } catch (error) {
      console.error("Error loading reviews:", error);
      allReviews = generateReviews();
      totalEl.textContent = allReviews.length;
      renderReviews(allReviews);
    }
  }

  function filterReviews() {
    if (currentFilter === 'all') return allReviews;
    return allReviews.filter(r => r.rating === parseInt(currentFilter));
  }

  function renderReviews(reviews) {
    const lang = localStorage.getItem('nexo_lang') || 'en';
    
    if (!reviews.length) {
      const emptyText = lang === 'ru' ? '–û—Ç–∑—ã–≤–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : 'No reviews found';
      container.innerHTML = `<div class="empty-state">${emptyText}</div>`;
      return;
    }
    
    // Re-generate reviews when language changes to get correct text
    if (allReviews.length && !allReviews[0].text.match(lang === 'ru' ? /[–∞-—è–ê-–Ø]/ : /[a-zA-Z]/)) {
      allReviews = generateReviews();
      reviews = filterReviews();
      totalEl.textContent = allReviews.length;
    }

    container.innerHTML = reviews.map(review => {
      const stars = '‚òÖ'.repeat(review.rating) + '‚òÜ'.repeat(5 - review.rating);
      const colors = ['#4f46e5', '#7c3aed', '#2563eb', '#0891b2', '#059669', '#d97706', '#dc2626'];
      const bgColor = colors[review.id % colors.length];
      
      return `
        <div class="review-card">
          <div class="review-header">
            <div class="review-user">
              <div class="user-avatar" style="background: linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 100%);">
                ${review.initials || review.name?.charAt(0) || '?'}
              </div>
              <div class="user-info">
                <div class="user-name">${review.name || review.author_name || 'User'}</div>
                <div class="user-badge">‚úì ${review.badge || (lang === 'ru' ? '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω' : 'Verified')}</div>
              </div>
            </div>
            <div class="review-date">${review.date || ''}</div>
          </div>
          <div class="review-text">${review.text}</div>
          <div class="review-footer">
            <div class="review-stars">${stars}</div>
            <div class="review-helpful">
              <button class="helpful-btn">üëç</button>
              <span>${review.helpful || ''}</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  // Filter tabs
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentFilter = tab.dataset.filter;
      renderReviews(filterReviews());
    });
  });

  // Back to top button
  const backToTopBtn = document.getElementById('backToTop');
  
  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      backToTopBtn.classList.add('show');
    } else {
      backToTopBtn.classList.remove('show');
    }
  });
  
  backToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Initialize
  loadReviews();
</script>

<!-- Bottom Navigation Bar -->
<nav class="bottom-nav">
    <a href="index.html" class="nav-item">
        <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg></span>
        <span class="nav-label" data-i18n="assets">–ê–∫—Ç–∏–≤—ã</span>
    </a>
    <a href="trading.html" class="nav-item">
        <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg></span>
        <span class="nav-label" data-i18n="markets">–†—ã–Ω–∫–∏</span>
    </a>
    <a href="exchange.html" class="nav-item">
        <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/></svg></span>
        <span class="nav-label" data-i18n="exchange">–û–±–º–µ–Ω</span>
    </a>
    <a href="terminal.html" class="nav-item">
        <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg></span>
        <span class="nav-label" data-i18n="terminal">–¢–µ—Ä–º–∏–Ω–∞–ª</span>
    </a>
</nav>
</body>
</html>
